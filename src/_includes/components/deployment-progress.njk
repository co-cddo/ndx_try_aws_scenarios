{#
  Deployment Status Component

  Static educational content explaining:
  - How to check session status on NDX portal
  - How to view CloudFormation stack status in AWS Console
  - What deployment phases mean

  Required variables:
    - scenarioData: The scenario object from scenarios.yaml
#}

{% if scenarioData and scenarioData.deployment %}
<div class="ndx-deployment-status" id="deployment-status" role="region" aria-labelledby="deployment-status-title">
  <h2 class="govuk-heading-m" id="deployment-status-title">Check your deployment status</h2>

  <p class="govuk-body">After requesting a session via the NDX:Try portal, you can monitor your deployment in two ways:</p>

  {# NDX Portal Status #}
  <div class="govuk-!-margin-bottom-6">
    <h3 class="govuk-heading-s">1. NDX:Try Portal</h3>
    <p class="govuk-body">View your active sessions and their status on the NDX portal:</p>
    <p class="govuk-body">
      <a href="https://ndx.digital.cabinet-office.gov.uk/try" class="govuk-button govuk-button--secondary" data-module="govuk-button">
        View your NDX:Try sessions
      </a>
    </p>
    <p class="govuk-body-s">Your session will show as <strong>Active</strong> when deployment is complete.</p>
  </div>

  {# CloudFormation Console Status #}
  <div class="govuk-!-margin-bottom-6">
    <h3 class="govuk-heading-s">2. AWS CloudFormation Console</h3>
    <p class="govuk-body">For detailed deployment progress, access your AWS account via IAM Identity Center:</p>
    <ol class="govuk-list govuk-list--number">
      <li>Sign in via <a href="https://d-9c6780eac5.awsapps.com/start" class="govuk-link" target="_blank" rel="noopener noreferrer">IAM Identity Center<span class="govuk-visually-hidden"> (opens in new tab)</span></a></li>
      <li>Select your NDX:Try account and <code>ndx_IsbUsersPS</code> role</li>
      <li>Navigate to CloudFormation to view your stack</li>
    </ol>
    <p class="govuk-body">
      <a href="https://console.aws.amazon.com/cloudformation/home?region={{ scenarioData.deployment.region | default('eu-west-2') }}#/stacks?filteringStatus=active" class="govuk-link" target="_blank" rel="noopener noreferrer">
        Open CloudFormation Console<span class="govuk-visually-hidden"> (opens in new tab)</span>
      </a>
    </p>
  </div>

  {# Stack Status Meanings #}
  <details class="govuk-details">
    <summary class="govuk-details__summary">
      <span class="govuk-details__summary-text">Understanding CloudFormation stack status</span>
    </summary>
    <div class="govuk-details__text">
      <dl class="govuk-summary-list govuk-summary-list--no-border">
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key"><code>CREATE_IN_PROGRESS</code></dt>
          <dd class="govuk-summary-list__value">Resources are being created. Wait for completion.</dd>
        </div>
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key"><code>CREATE_COMPLETE</code></dt>
          <dd class="govuk-summary-list__value">Deployment successful. Check the Outputs tab for access details.</dd>
        </div>
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key"><code>ROLLBACK_IN_PROGRESS</code></dt>
          <dd class="govuk-summary-list__value">Deployment failed. Resources are being cleaned up.</dd>
        </div>
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key"><code>DELETE_COMPLETE</code></dt>
          <dd class="govuk-summary-list__value">Session has ended and resources have been removed.</dd>
        </div>
      </dl>
    </div>
  </details>

  {# Deployment Phases Educational Content #}
  {% if scenarioData.deployment.deploymentPhases and scenarioData.deployment.deploymentPhases | length > 0 %}
  <details class="govuk-details govuk-!-margin-top-4">
    <summary class="govuk-details__summary">
      <span class="govuk-details__summary-text">What happens during deployment</span>
    </summary>
    <div class="govuk-details__text">
      <p class="govuk-body-s">When your session is provisioned, CloudFormation creates these resources:</p>
      <ol class="govuk-list govuk-list--number govuk-body-s">
        {% for phase in scenarioData.deployment.deploymentPhases %}
        <li>{{ phase }}</li>
        {% endfor %}
      </ol>
      <p class="govuk-body-s govuk-!-margin-top-2">
        <strong>Estimated time:</strong> {{ scenarioData.deployment.deploymentTime | default('5-15 minutes') }}
      </p>
    </div>
  </details>
  {% endif %}
</div>
{% endif %}
