{#
  Demo Video Section Component (Story 2.4)

  Wrapper component for scenario demo videos with transcript support.

  Features (AC-2.4.1, AC-2.4.4, AC-2.4.5):
    - "Not Ready to Deploy? Watch Instead" heading
    - Video player with responsive embed
    - Video metadata (duration, recording date)
    - Expandable transcript section using govuk-details
    - Positioned before deployment section

  Requires scenarioData with video metadata:
    video.youtubeId: string - YouTube video ID
    video.title: string - Video title
    video.duration: string - Video duration (e.g., "5:30")
    video.recordedDate: string - Recording date (ISO format)
    video.transcript: string - Transcript text (optional)
#}

{% if scenarioData and scenarioData.video and scenarioData.video.youtubeId %}
<div class="ndx-demo-video-section" id="demo-video">
  <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">

  {# Section heading (AC-2.4.1) #}
  <h2 class="govuk-heading-l">Not ready to deploy? Watch instead</h2>

  <p class="govuk-body-l">
    See exactly what this scenario does without deploying anything. Our walkthrough video shows the complete experience in {{ scenarioData.video.duration | default('5-10 minutes') }}.
  </p>

  {# Video metadata display (AC-2.4.6) #}
  <div class="ndx-demo-video-section__meta govuk-!-margin-bottom-4">
    <p class="govuk-body-s govuk-!-margin-bottom-2">
      {% if scenarioData.video.duration %}
        <span class="ndx-demo-video-section__duration">
          <strong>Duration:</strong> {{ scenarioData.video.duration }}
        </span>
      {% endif %}
      {% if scenarioData.video.recordedDate %}
        <span class="ndx-demo-video-section__recorded{% if scenarioData.video.duration %} govuk-!-margin-left-4{% endif %}">
          <strong>Recorded:</strong>
          <time datetime="{{ scenarioData.video.recordedDate }}">
            {{ scenarioData.video.recordedDate | readableDate }}
          </time>
        </span>
      {% endif %}
    </p>
    {% if scenarioData.video.recordedDate %}
      <p class="govuk-body-s govuk-!-margin-bottom-0">
        <em>This video shows version {{ scenarioData.video.recordedDate | slice(0, 7) }} of the scenario.</em>
      </p>
    {% endif %}
  </div>

  {# Video player component (AC-2.4.2) #}
  {% set youtubeId = scenarioData.video.youtubeId %}
  {% set title = scenarioData.video.title | default(scenarioData.name + ' Demo Walkthrough') %}
  {% set scenarioName = scenarioData.name %}
  {% include "components/video-player.njk" %}

  {# Closed captions note (AC-2.4.3) #}
  <p class="govuk-body-s govuk-!-margin-top-2">
    This video includes closed captions. Enable captions using the CC button in the video player.
  </p>

  {# Transcript expandable section (AC-2.4.4) #}
  {% if scenarioData.video.transcript %}
  <details class="govuk-details govuk-!-margin-top-4" data-module="govuk-details">
    <summary class="govuk-details__summary">
      <span class="govuk-details__summary-text">
        Read the video transcript
      </span>
    </summary>
    <div class="govuk-details__text ndx-demo-video-section__transcript">
      {{ scenarioData.video.transcript | safe }}
    </div>
  </details>
  {% else %}
  <details class="govuk-details govuk-!-margin-top-4" data-module="govuk-details">
    <summary class="govuk-details__summary">
      <span class="govuk-details__summary-text">
        Video transcript
      </span>
    </summary>
    <div class="govuk-details__text">
      <p>Transcript is being prepared for this video. In the meantime, closed captions are available in the video player.</p>
      <p>
        <a href="https://www.youtube.com/watch?v={{ scenarioData.video.youtubeId }}"
           class="govuk-link"
           target="_blank"
           rel="noopener noreferrer">
          View on YouTube<span class="govuk-visually-hidden"> (opens in new tab)</span>
        </a>
        for auto-generated captions.
      </p>
    </div>
  </details>
  {% endif %}

  {# Video content summary #}
  <div class="ndx-demo-video-section__contents govuk-!-margin-top-6">
    <h3 class="govuk-heading-s">What the video covers</h3>
    <ol class="govuk-list govuk-list--number">
      <li>Introduction to {{ scenarioData.name }}</li>
      <li>Step-by-step deployment walkthrough</li>
      <li>Interactive demo of the deployed solution</li>
      <li>Exploring the results and outputs</li>
      <li>Reflection on what you experienced</li>
      <li>Guidance on what to do next</li>
    </ol>
  </div>
</div>

{% elif scenarioData and scenarioData.video %}
{# Coming soon placeholder - video metadata exists but no youtubeId yet #}
<div class="ndx-demo-video-section ndx-demo-video-section--coming-soon" id="demo-video">
  <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">

  <h2 class="govuk-heading-l">Not ready to deploy? Watch instead</h2>

  <div class="govuk-inset-text">
    <p><strong>Demo video coming soon</strong></p>
    <p>We're preparing a walkthrough video for this scenario. In the meantime, you can:</p>
    <ul class="govuk-list govuk-list--bullet">
      <li><a href="#" class="govuk-link">Request a guided tour</a> with one of our partners</li>
      <li><a href="/scenarios/" class="govuk-link">Explore other scenarios</a> with available demos</li>
      <li>Deploy the scenario and follow the step-by-step guide below</li>
    </ul>
  </div>
</div>
{% endif %}
