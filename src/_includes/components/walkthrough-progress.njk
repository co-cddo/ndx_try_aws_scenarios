{#
  Walkthrough Progress Sidebar Component - Story 2.6

  Combines progress bar and step checklist into a sticky sidebar.
  Includes reset functionality and dynamic updates via JavaScript.

  Expected context variables from walkthrough.njk layout:
  - currentScenarioId: String (scenario identifier)
  - currentScenarioTitle: String (human-readable title)
  - percentage: Number (completion percentage)
  - currentStep: Number (0 for intro, 1-N for steps, N+1 for complete)
  - totalSteps: Number (total walkthrough steps)
  - stepTitles: Array of step title objects

  Usage:
  {% include "components/walkthrough-progress.njk" %}
#}

{% set progressPercentage = percentage | default(0) %}

<aside class="ndx-walkthrough-progress"
       data-scenario-id="{{ currentScenarioId }}"
       aria-labelledby="progress-heading">

  {# Collapsible header for mobile #}
  <button class="ndx-walkthrough-progress__toggle"
          aria-expanded="true"
          aria-controls="progress-content"
          type="button">
    <h2 id="progress-heading" class="ndx-walkthrough-progress__heading">
      Your progress
    </h2>
    <span class="ndx-walkthrough-progress__toggle-icon" aria-hidden="true">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
        <path d="M8 11L3 6h10L8 11z"/>
      </svg>
    </span>
  </button>

  <div id="progress-content" class="ndx-walkthrough-progress__content">
    {# Scenario title #}
    <p class="ndx-walkthrough-progress__scenario">
      {{ currentScenarioTitle }}
    </p>

    {# Progress bar with live region for updates #}
    <div class="ndx-walkthrough-progress__bar-wrapper"
         aria-live="polite"
         aria-atomic="true"
         data-progress-display>
      {% include "components/progress-bar.njk" %}
    </div>

    {# Step checklist #}
    <div class="ndx-walkthrough-progress__steps" data-steps-display>
      {% include "components/step-checklist.njk" %}
    </div>

    {# Reset button #}
    <div class="ndx-walkthrough-progress__actions">
      <button type="button"
              class="ndx-walkthrough-progress__reset"
              data-reset-progress
              aria-describedby="reset-description">
        Reset progress
      </button>
      <span id="reset-description" class="govuk-visually-hidden">
        This will clear all your progress and start from the beginning
      </span>
    </div>
  </div>

  {# Reset confirmation modal (hidden by default) #}
  <div class="ndx-reset-modal"
       role="dialog"
       aria-modal="true"
       aria-labelledby="reset-modal-title"
       aria-describedby="reset-modal-desc"
       hidden
       data-reset-modal>
    <div class="ndx-reset-modal__backdrop"></div>
    <div class="ndx-reset-modal__dialog">
      <h3 id="reset-modal-title" class="ndx-reset-modal__title">
        Reset your progress?
      </h3>
      <p id="reset-modal-desc" class="ndx-reset-modal__description">
        This will clear all your progress through the {{ currentScenarioTitle }} walkthrough. You'll start from the beginning.
      </p>
      <div class="ndx-reset-modal__actions">
        <button type="button"
                class="ndx-reset-modal__confirm"
                data-reset-confirm>
          Yes, reset progress
        </button>
        <button type="button"
                class="ndx-reset-modal__cancel"
                data-reset-cancel>
          Cancel
        </button>
      </div>
    </div>
  </div>
</aside>
