{#
  Deployment Guide Component

  Displays guidance on what to expect after clicking the deploy button,
  including CloudFormation console preview, deployment phases, and estimated time.

  Required variables:
    - scenarioData: The scenario object from scenarios.yaml
#}

{% if scenarioData and scenarioData.deployment %}
<div class="ndx-deployment-guide" id="deployment-guide">
  <h2 class="govuk-heading-m">What happens next</h2>

  <p class="govuk-body">After clicking deploy, you'll be taken to the <strong>AWS CloudFormation Console</strong> to complete the deployment.</p>

  {# Estimated Deployment Time #}
  {% if scenarioData.deployment.deploymentTime %}
  <div class="ndx-deployment-guide__time">
    <p class="govuk-body-l govuk-!-margin-bottom-2">
      <strong>Estimated time:</strong> {{ scenarioData.deployment.deploymentTime }}
    </p>
  </div>
  {% endif %}

  {# Deployment Phases Timeline #}
  {% if scenarioData.deployment.deploymentPhases and scenarioData.deployment.deploymentPhases | length > 0 %}
  <details class="govuk-details">
    <summary class="govuk-details__summary">
      <span class="govuk-details__summary-text">View deployment phases</span>
    </summary>
    <div class="govuk-details__text">
      <ol class="ndx-deployment-timeline" aria-label="Deployment phases">
        {% for phase in scenarioData.deployment.deploymentPhases %}
        <li class="ndx-deployment-timeline__item">
          <span class="ndx-deployment-timeline__marker" aria-hidden="true">{{ loop.index }}</span>
          <span class="ndx-deployment-timeline__content">{{ phase }}</span>
        </li>
        {% endfor %}
      </ol>
    </div>
  </details>
  {% endif %}

  {# CloudFormation Console Guidance #}
  <h3 class="govuk-heading-s">In the CloudFormation Console</h3>

  <div class="ndx-deployment-guide__steps">
    <ol class="govuk-list govuk-list--number">
      <li>
        <strong>Review parameters</strong> - All settings are pre-filled. No changes needed.
      </li>
      <li>
        <strong>Acknowledge capabilities</strong> - Tick the checkbox to allow IAM resource creation.
      </li>
      <li>
        <strong>Click "Create stack"</strong> - This starts the deployment.
      </li>
      <li>
        <strong>Monitor progress</strong> - Watch the Events tab for real-time updates.
      </li>
    </ol>
  </div>

  {# Success and Failure Indicators #}
  <h3 class="govuk-heading-s">How to know when it's done</h3>

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-one-half">
      <div class="ndx-deployment-guide__indicator ndx-deployment-guide__indicator--success">
        <div class="ndx-deployment-guide__indicator-content">
          <strong class="govuk-body">Success</strong>
          <p class="govuk-body-s govuk-!-margin-bottom-0">Stack status shows <code>CREATE_COMPLETE</code> in green.</p>
        </div>
      </div>
    </div>
    <div class="govuk-grid-column-one-half">
      <div class="ndx-deployment-guide__indicator ndx-deployment-guide__indicator--failure">
        <div class="ndx-deployment-guide__indicator-content">
          <strong class="govuk-body">Failure</strong>
          <p class="govuk-body-s govuk-!-margin-bottom-0">Stack status shows <code>ROLLBACK_COMPLETE</code> in red.</p>
        </div>
      </div>
    </div>
  </div>

  {# CloudFormation Console Deep Link #}
  <p class="govuk-body govuk-!-margin-top-4">
    <a href="https://console.aws.amazon.com/cloudformation/home?region={{ scenarioData.deployment.region | default('us-east-1') }}#/stacks" class="govuk-link" target="_blank" rel="noopener noreferrer">
      View your CloudFormation stacks<span class="govuk-visually-hidden"> (opens in new tab)</span>
    </a>
  </p>

  {# Tips for non-technical users #}
  <div class="govuk-inset-text">
    <strong>Tip:</strong> The Events tab in CloudFormation Console auto-refreshes every few seconds. You do not need to manually refresh the page.
  </div>
</div>
{% endif %}
