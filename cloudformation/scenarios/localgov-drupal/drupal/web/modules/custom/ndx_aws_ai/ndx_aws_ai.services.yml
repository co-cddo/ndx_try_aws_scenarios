services:
  # AWS Client Factory - creates AWS service clients with IAM role credentials
  ndx_aws_ai.client_factory:
    class: Drupal\ndx_aws_ai\Service\AwsClientFactory
    arguments:
      - '@config.factory'
      - '@logger.factory'

  # AWS Error Handler - standardized error processing for AWS API failures
  ndx_aws_ai.error_handler:
    class: Drupal\ndx_aws_ai\Service\AwsErrorHandler
    arguments:
      - '@logger.factory'
      - '@string_translation'

  # Prompt Template Manager - loads and renders YAML prompt templates
  ndx_aws_ai.prompt_template_manager:
    class: Drupal\ndx_aws_ai\PromptTemplate\PromptTemplateManager
    arguments:
      - '@module_handler'
      - '@logger.channel.ndx_aws_ai'

  # Bedrock Rate Limiter - implements exponential backoff for API calls
  ndx_aws_ai.bedrock_rate_limiter:
    class: Drupal\ndx_aws_ai\RateLimiter\BedrockRateLimiter
    arguments:
      - '@logger.channel.ndx_aws_ai'

  # Bedrock Response Parser - extracts content and usage from API responses
  ndx_aws_ai.bedrock_response_parser:
    class: Drupal\ndx_aws_ai\Response\BedrockResponseParser
    arguments:
      - '@logger.channel.ndx_aws_ai'

  # Bedrock Service - AI content generation using Amazon Nova models
  ndx_aws_ai.bedrock:
    class: Drupal\ndx_aws_ai\Service\BedrockService
    arguments:
      - '@ndx_aws_ai.client_factory'
      - '@ndx_aws_ai.error_handler'
      - '@ndx_aws_ai.prompt_template_manager'
      - '@ndx_aws_ai.bedrock_rate_limiter'
      - '@ndx_aws_ai.bedrock_response_parser'

  # Logger channel for ndx_aws_ai module
  logger.channel.ndx_aws_ai:
    parent: logger.channel_base
    arguments: ['ndx_aws_ai']

  # Story 3.5: Prompt History Service - stores recent prompts per user
  ndx_aws_ai.prompt_history:
    class: Drupal\ndx_aws_ai\Service\PromptHistoryService
    arguments:
      - '@tempstore.private'
      - '@current_user'

  # Story 4.1: Polly Rate Limiter - implements exponential backoff for Polly API calls
  ndx_aws_ai.polly_rate_limiter:
    class: Drupal\ndx_aws_ai\RateLimiter\PollyRateLimiter
    arguments:
      - '@logger.channel.ndx_aws_ai'

  # Story 4.1: Polly Service - text-to-speech synthesis with 7 languages
  ndx_aws_ai.polly:
    class: Drupal\ndx_aws_ai\Service\PollyService
    arguments:
      - '@ndx_aws_ai.client_factory'
      - '@ndx_aws_ai.error_handler'
      - '@ndx_aws_ai.polly_rate_limiter'
      - '@cache.default'
      - '@file_system'
      - '@logger.channel.ndx_aws_ai'

  # Story 4.2: Translate Rate Limiter - implements exponential backoff for Translate API calls
  ndx_aws_ai.translate_rate_limiter:
    class: Drupal\ndx_aws_ai\RateLimiter\TranslateRateLimiter
    arguments:
      - '@logger.channel.ndx_aws_ai'

  # Story 4.2: Translate Service - multi-language translation with 75+ languages
  ndx_aws_ai.translate:
    class: Drupal\ndx_aws_ai\Service\TranslateService
    arguments:
      - '@ndx_aws_ai.client_factory'
      - '@ndx_aws_ai.error_handler'
      - '@ndx_aws_ai.translate_rate_limiter'
      - '@cache.default'
      - '@logger.channel.ndx_aws_ai'
